<div class="container">
	<div class="col-md-12">
		<span><h1 style="display:inline-block;">Music</h1> 
		<%= link_to new_music_path, class: "pull-right" do %>
			<span class="glyphicon glyphicon-plus"></span> Add Music
		<% end %>
		</span>
		<ul class="list-group">
			<% player_count = 1 %>
			<% @musics.each do |music| %>
				<script type="text/javascript">
					$(document).ready(function(){
						$('#jquery_jplayer_<%=player_count%>').jPlayer({
							supplied: "mp3",
							smoothPlayBar: true,
							preload: "metadata",
							keyEnabled: true,
							play: function(){
								$(this).jPlayer("pauseOthers");
							},
							smoothPlayBar: true,
							keyEnabled: true,
							cssSelectorAncestor: "#jp_container_<%=player_count%>",
							ready: function () {
								$(this).jPlayer("setMedia", {mp3: "<%= music.direct_upload_url %>"} );
							}
						});
					});
				</script>		
				<li class="list-group-item">
					<div style="display:inline-block;">
						<% if music.user.avatar.exists? %>
							<%= image_tag music.user.avatar.url(:thumb) %>
						<% end %>
						<h2><%= music.user.username %></h2>
					</div>
					<div style="display:inline-block; width:80%;">
					<%= music.upload_file_name %>
					<span id="jquery_jplayer_<%=player_count%>" class="jp-jplayer"></span>
					<div id="jp_container_<%=player_count%>" class="jp-audio">
						<div class="jp-gui jp-interface">
							<span class="jp-controls pull-right">
								<button type="button" class="jp-play btn btn-link btn-lg"><span class="glyphicon glyphicon-play"</span></button>
								<button type="button" class="jp-pause btn btn-link btn-lg"><span class="glyphicon glyphicon-pause"></span></button>
							</span>
							<div class="jp-progress" style="width:50%;">
								<div class="jp-seek-bar progress" style="width:100%;">
									<div class="jp-play-bar progress-bar" style="width:0%;"></div>
								</div>
							</div>
						</div>
					</div>
					</span>
					<% if music.user.id == current_user.id %><%= link_to music, method: :delete, data: {confirm: "Are you sure?" } do %><span class="glyphicon glyphicon-trash"></span><% end %><% end %>
				</div>
					<div>
						<%= render partial: "tags/form", locals: {music: music} %>
						<span class="tags">
							<% music.tags.each do |tag| %>
								<button type="button" class="btn btn-default"><%= tag.category%>: <%=tag.description%></button>
							<% end %>
						</span>
					</div>
				</li>
				<% player_count += 1 %>
			<% end %>
		</ul>
	</div>
</div>

<script type="text/javascript">
	$(document).ready(function(){
		$('#jquery_jplayer_1').jPlayer({
			preload: "none",
			supplied: "mp3",
			swfPath: "http://www.jplayer.org/latest/js/Jplayer.swf",
			keyEnabled: true,
			play: function(){
				$(this).jPlayer("pauseOthers");
			},
			keyEnabled: true,
			cssSelectorAncestor: "",
			cssSelector: {
				play:".jp-play",
				pause:".jp-pause",
				seekBar:".jp-seek-bar",
				playBar:".jp-play-bar"
			},
			ready: function () {
				$(this).jPlayer("setMedia", {mp3: "<%= @track.upload.url %>"} );
			},
		});
		
		$('.list-group-item').click(function(){
			music_id = $(this).data("music_id");
			music_url = $(this).data("music_url");
			$("#jquery_jplayer_1").jPlayer("setMedia", {mp3: music_url } ); 
		});
	});
</script>		
<div class="row row-offcanvas row-offcanvas-left">
	<%= link_to new_music_path, class: "pull-right" do %>
		<span class="glyphicon glyphicon-plus"></span> Add Music
	<% end %>
	<div class="col-xs-12 col-sm-4 sidebar-offcanvas" id="sidebar">
		<div id="player">
			<div class="media">
				<div class="pull-left">
					<% if @track.user.avatar.exists? %>
						<%= image_tag @track.user.avatar.url(:thumb), class: "media-object" %>
					<% end %>
					<span id="thanks" style="position:relative; margin-bottom:0; margin-top:-50px;"></span>
				</div>
				<div class="media-body" style="height:50px;">
					<h6 class="media-heading"><%= @track.user.username %> - <%= @track.name %></h6>
					<span id="jquery_jplayer_1" class="jp-jplayer"></span>
					<div class="jp-seek-bar progress">
						<div class="jp-play-bar progress-bar"></div>
					</div>
				</div>
				<div id="player-buttons" style="height:30px;">
					<span id="jp-controls" >
						<button type="button" class="jp-play btn btn-link btn-lg" style="padding:0"><span class="glyphicon glyphicon-play"></span></button>
						<button type="button" class="jp-pause btn btn-link btn-lg" style="padding:0"><span class="glyphicon glyphicon-pause"></span></button>
					</span>
					<%= render partial: 'shared/favorite_form', locals: {music:@track} if signed_in? %>	
					<% if @track.user.id != current_user.id %><%= link_to user_pay_path(@track.user, music_id: @track.id), method: :post, remote: true, class: "pull-right" do %><%= image_tag 'dogecoin-icon.png' %><% end %><% end %>
				</div>
			</div>
			<div id="tags" style="margin-bottom:5px;">
				<span class="btn-group">
					<% @track.tags.each do |tag| %>
						<button type="button" class="btn btn-default btn-xs"><%=tag.description%></button>
					<% end %>
				</span>
			</div>
		</div>
		<ul class="list-group">
			<% player_count = 1 %>
			<% @musics[1..-1].each do |music| %>
				<% if player_count < @musics.count %>
					<% next_player = player_count + 1 %>
				<% else %>
					<% next_player = 1 %>
				<% end %>
				<li class="list-group-item" data-music_id="<%=music.id%>" data-music_url="<%=music.upload.url %>">
					<%= music.name %>	
				</li>
				<% player_count += 1 %>
			<% end %>
		</ul>
	</div>
	<div class="col-xs-12 col-sm-8">
		<p>Welcome! Welcome!</p>
	</div>
</div>
